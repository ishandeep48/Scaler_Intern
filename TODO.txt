**Role:** You are a Senior Full Stack Engineer specializing in Next.js 14 (App Router), MongoDB, and High-Performance Real-Time Systems.

**Objective:** Build the complete **Backend Infrastructure** for "BrainBolt," an adaptive infinite quiz platform.
**Constraint:** You have strictly 30 minutes to generate this code. Prioritize correctness, atomic operations, and specific algorithmic implementation over bells and whistles.

**Tech Stack:**
- **Framework:** Next.js 14+ (App Router, API Routes).
- **Database:** MongoDB (via Mongoose).
- **Caching/Real-time:** Redis (via `ioredis`).
- **Containerization:** Docker & Docker Compose.
- **Language:** TypeScript.

---

### **Step 1: Docker & Environment Setup**
Create a `docker-compose.yml` file in the root with the following services:
1.  **mongodb**: Image `mongo:latest`, Port `27017`, Volume `./data/mongo:/data/db`.
2.  **redis**: Image `redis:alpine`, Port `6379`.
3.  **app**: (Placeholder for the Next.js app) - ensure it links to mongo and redis.
4.  Create a `.env.local` template with:
    - `MONGODB_URI=mongodb://localhost:27017/brainbolt`
    - `REDIS_URL=redis://localhost:6379`

### **Step 2: Database Connection & Schemas (Mongoose)**
1.  Create `lib/mongodb.ts`: Implement the cached connection pattern (check `global.mongoose`) to prevent connection exhaustion in Next.js hot-reloading.
2.  Create `models/User.ts`:
    - `username`: String, unique.
    - `currentScore`: Number (default 0).
    - `currentStreak`: Number (default 0).
    - `maxStreak`: Number (default 0).
    - `currentDifficulty`: Number (default 1, min 1, max 10).
    - `momentum`: Number (default 0) -> *Critical for adaptive stability*.
3.  Create `models/Question.ts`:
    - `difficulty`: Number (Index this).
    - `prompt`: String.
    - `choices`: Array of Strings.
    - `correctAnswer`: String (Select: false in queries by default to prevent cheating).
4.  Create `models/AnswerLog.ts`:
    - `userId`: ObjectId, `questionId`: ObjectId, `isCorrect`: Boolean, `timestamp`: Date.

### **Step 3: The Adaptive Logic (The "Stabilizer")**
Create a utility function `lib/gameLogic.ts`.
Implement `calculateNextState(currentDifficulty, currentMomentum, isCorrect)`:
- **Ping-Pong Fix (Momentum):**
    - **IF Correct:** Increment `momentum`.
        - If `momentum >= 2`: `newDifficulty = min(currentDifficulty + 1, 10)`, `newMomentum = 0`.
        - Else: `newDifficulty = currentDifficulty`, `newMomentum = momentum`.
    - **IF Wrong:** `newDifficulty = max(currentDifficulty - 1, 1)`, `newMomentum = 0` (Immediate drop).
- **Scoring Formula:**
    - `base` = `difficulty * 10`.
    - `multiplier` = `1 + (streak * 0.1)` (Cap at 2.5x).
    - `scoreDelta` = `base * multiplier`.

### **Step 4: Redis Leaderboard Manager**
Create `lib/redis.ts` using `ioredis`. Implement:
1.  `updateLeaderboard(userId, username, score, streak)`:
    - Use `zadd` on `leaderboard:score` (score as value).
    - Use `zadd` on `leaderboard:streak` (streak as value).
    - Store username mapping if needed, or store "score:username" as the member.
2.  `getTopScorers(limit=10)`: Return distinct top users.

### **Step 5: API Routes (App Router)**

**1. `GET /api/quiz/next`**
- **Input:** `userId` (query param).
- **Logic:**
    - Fetch User.
    - MongoDB Aggregation: `$match` `{ difficulty: user.currentDifficulty }`, `$sample` `{ size: 1 }`.
    - **Return:** Question (without correct answer), current `streak`, current `score`.

**2. `POST /api/quiz/answer` (Transactional Logic)**
- **Input:** `userId`, `questionId`, `answer`, `idempotencyKey`.
- **Logic:**
    1.  **Idempotency:** Check Redis key `idemp:${userId}:${questionId}`. If exists, return cached result.
    2.  **Fetch:** Get Question (with correct answer) and User.
    3.  **Validate:** Compare `answer` vs `question.correctAnswer`.
    4.  **Calculate:** Use `calculateNextState` from Step 3.
    5.  **Update (Atomic):** Update User document with new `score`, `streak`, `difficulty`, `momentum`.
    6.  **Side Effects:** Update Redis Leaderboard. Set Idempotency key (TTL 10m).
    7.  **Return:** `correct` (bool), `newDifficulty`, `newStreak`, `newScore`, `totalScore`.

**3. `GET /api/leaderboard`**
- Returns top 10 from Redis ZSETs for both Score and Streak.

### **Step 6: Seeding Script**
Create `scripts/seed.ts` (executable via `ts-node`).
- Clear existing questions.
- Generate 50 Math/CS questions distributed across difficulties 1-10.
- Example: Diff 1: "2+2?", Diff 10: "Worst case of Bubble Sort?".

---
**Execution:**
Start by generating the `docker-compose.yml`, then the `lib/mongodb.ts`, then the Models, then the API routes. Ensure code is strictly typed.